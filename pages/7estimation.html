<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Estimating the model – Geospatial small area estimation in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-48ffa3e5b9d089919c6712c39e5b00f2.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-2be10d9e998f81ff6e49e26833438aa5.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./7estimation.html">7. Estimating the model</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Geospatial small area estimation in R</a> 
    </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1. Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2rsetup.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">2. R setup</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3vectorfiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3. Vector files (shapefiles)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./4rasterfiles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">4. Rasters</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./5surveydata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">5. Survey data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./6features.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">6. Creating and selecting features</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./7estimation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">7. Estimating the model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./8mapping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">8. Mapping the results</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./9conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">9. Conclusion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendices.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix: Additional resources</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#sec-estimating" id="toc-sec-estimating" class="nav-link active" data-scroll-target="#sec-estimating"><span class="header-section-number">3</span> Estimating the model</a>
  <ul class="collapse">
  <li><a href="#sec-povmap" id="toc-sec-povmap" class="nav-link" data-scroll-target="#sec-povmap"><span class="header-section-number">3.1</span> povmap</a></li>
  <li><a href="#sec-options" id="toc-sec-options" class="nav-link" data-scroll-target="#sec-options"><span class="header-section-number">3.2</span> Specifying options e.g.&nbsp;weighting, transformations, benchmarking</a></li>
  <li><a href="#sec-assumptions" id="toc-sec-assumptions" class="nav-link" data-scroll-target="#sec-assumptions"><span class="header-section-number">3.3</span> Verifying the assumptions</a></li>
  <li><a href="#sec-evaluation" id="toc-sec-evaluation" class="nav-link" data-scroll-target="#sec-evaluation"><span class="header-section-number">3.4</span> Evaluating results</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">3.5</span> References</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Estimating the model</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="sec-estimating" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Estimating the model</h1>
<p>In this section, we will estimate the model we have been building up to. We will use an updated version of the <code>povmap</code> package, which is not yet on CRAN, so we will download the GitHub version.</p>
<section id="sec-povmap" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="sec-povmap"><span class="header-section-number">3.1</span> povmap</h2>
<p>The <code>povmap</code> package contains many functions that enable small area estimation using a variety of methods. The package is under active development, but its CRAN version is stable. You can find a pdf of the package’s documentation <a href="https://cran.r-project.org/web/packages/povmap/povmap.pdf">here</a> and you can find more updated versions – that are not yet on CRAN – on the World Bank’s Sub-Saharan Africa Statistical Team’s GitHub page <a href="https://github.com/SSA-Statistical-Team-Projects/povmap">here</a>. As noted, we are not going to use the CRAN version. Instead, we are going to use a more updated version that includes different options for the <code>ebp()</code> function. Here is the code to install the package off GitHub:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"SSA-Statistical-Team-Projects/povmap"</span>, <span class="at">ref =</span> <span class="st">"david3"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you receive an error trying to install <code>povmap</code> – for example, if the authors of that package update the CRAN version and remove the <code>david3</code> branch – we have also uploaded a <code>.zip</code> file of the package on our <a href="https://github.com/JoshMerfeld/geospatialSAEhowto">GitHub page</a>. You can download the compressed <code>.zip</code> file and then install it using <code>devtools::install_local(PATH)</code>, where <code>PATH</code> is the path to the <code>.zip</code> file.</p>
<p>For this example, we will be using the function <code>ebp()</code>, which stands for empirical best prediction (<a href="#1">Molina and Rao, 2010</a>). We will be estimating a sub-area model, in which the admin4 geography is the sub-area, and predicting at the admin3 (TA – or Traditional Authority – in Malawi) level.</p>
<p>In the previous section, we already set up our data for the estimation. Our outcome variable is contained in the <code>pov</code> object and our predictors are in the ‘features’ object.</p>
<p>The simplest specification of our model is as follows: </p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="annotated-cell-2"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-2-1"><a href="#annotated-cell-2-1"></a>results <span class="ot">&lt;-</span> <span class="fu">ebp</span>(</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-2-2" class="code-annotation-target"><a href="#annotated-cell-2-2"></a>  <span class="at">fixed =</span> ebpformula,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-2-3" class="code-annotation-target"><a href="#annotated-cell-2-3"></a>  <span class="at">pop_data =</span> features,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-2-4" class="code-annotation-target"><a href="#annotated-cell-2-4"></a>  <span class="at">pop_domains =</span> <span class="st">"TA_CODE"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-2-5" class="code-annotation-target"><a href="#annotated-cell-2-5"></a>  <span class="at">smp_data =</span> pov,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="5" onclick="event.preventDefault();">5</a><span id="annotated-cell-2-6" class="code-annotation-target"><a href="#annotated-cell-2-6"></a>  <span class="at">smp_domains =</span> <span class="st">"TA_CODE"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="6" onclick="event.preventDefault();">6</a><span id="annotated-cell-2-7" class="code-annotation-target"><a href="#annotated-cell-2-7"></a>  <span class="at">MSE =</span> <span class="cn">TRUE</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="7" onclick="event.preventDefault();">7</a><span id="annotated-cell-2-8" class="code-annotation-target"><a href="#annotated-cell-2-8"></a>  <span class="at">transformation =</span> <span class="st">"arcsin"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-2" data-target-annotation="8" onclick="event.preventDefault();">8</a><span id="annotated-cell-2-9" class="code-annotation-target"><a href="#annotated-cell-2-9"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-2-10"><a href="#annotated-cell-2-10"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-2" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="2" data-code-annotation="1"><code>fixed = ebpformula</code>: This is the formula we created above, which includes the non-zero coefficients selected using lasso.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="3" data-code-annotation="2"><code>pop_data = features</code>: This is the dataset that includes the predictors for the <em>population</em>. In this case, it is the <code>features</code> object.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="4" data-code-annotation="3"><code>pop_domains = "TA_CODE"</code>: This is the identifier for the area in the population data. In our example, it is the admin3 identifier, the <code>TA_CODE</code>.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="5" data-code-annotation="4"><code>smp_data = pov</code>: This is the dataset that includes the outcome of interest. This is created from a survey, so it does not cover all of the admin3 areas. In our example, it is the <code>pov</code> object.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="6" data-code-annotation="5"><code>smp_domains = "TA_CODE"</code>: This is the identifier for the area in the sample data. It has the same name as the <code>pop_domains</code> in this case.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="7" data-code-annotation="6"><code>MSE = TRUE</code>: This tells the function to calculate variance estimates.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="8" data-code-annotation="7"><code>transformation = "arcsin"</code>: This is the transformation we used above. Note that the default for <code>ebp()</code> is a box-cox transformation. If you do not want to use a transformation, you can specify <code>transformation = "no"</code>. Importantly, we need to give <code>ebp()</code> the <em>untransformed</em> outcome variable in the <code>pov</code> object, since we are asking <code>ebp90</code> to then make the transformation.</span>
</dd>
<dt data-target-cell="annotated-cell-2" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-2" data-code-lines="9" data-code-annotation="8"><code>na.rm = TRUE</code>: This tells the function to remove missing values. This is important because the function will not run if there are any missing values. Ideally, you should clean your data such that this option is not strictly necessary (i.e.&nbsp;there will already be no missing values). </span>
</dd>
</dl>
</div>
</div>
</section>
<section id="sec-options" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="sec-options"><span class="header-section-number">3.2</span> Specifying options e.g.&nbsp;weighting, transformations, benchmarking</h2>
<p>We have already seen the use of one option: the transformation. But <code>ebp()</code> also takes other options, as well. Specifically, let’s discuss weights and benchmarking options.</p>
<p>For weights, we can specify two different types of weights: sample weights and population weights.</p>
<ul>
<li><p>Sample weights are weights that are used to adjust for the fact that some observations are more likely to be in the sample than others. In our case, we have already created these weights in the <code>pov</code> object; they are in the column called <code>total_weights</code>.</p></li>
<li><p>Population weights are used to adjust for the fact that different subareas have different populations. Since we want to calculate a population-weighted poverty rate at the admin3 level, we can use the <code>pop_weights</code> option. We have estimated population (from WorldPop) in the column entitled <code>mwpop</code> in the <code>features</code> data.</p></li>
</ul>
<p>We can also <em>benchmark</em> the estimates such that they match existing official statistics for higher level geographies. In our example, we have data only from the Northern region of Malawi. The <a href="https://microdata.worldbank.org/index.php/catalog/3818/related-materials">2020 Malawi Poverty Report</a> states that the official poverty rate for the region is 32.9 percent. We are using proportions, so we want to benchmark the overall values to equal 0.329, on average. We need to give the <code>ebp</code> function a <em>named vector</em>, where the name equals the indicator we want to benchmark and the value is the benchmark value. The function can benchmark for the the <code>"Mean"</code> or <code>"Head_Count"</code>. Although we are estimating head count poverty, we are actually estimating the mean poverty rate in each admin3 area. We can create the named vector as follows:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>bench <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Mean"</span> <span class="ot">=</span> <span class="fl">0.329</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Putting this all together, we can estimate our final model:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><span id="annotated-cell-4-1"><a href="#annotated-cell-4-1"></a>results <span class="ot">&lt;-</span> <span class="fu">ebp</span>(</span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2"></a>  <span class="at">fixed =</span> ebpformula,</span>
<span id="annotated-cell-4-3"><a href="#annotated-cell-4-3"></a>  <span class="at">pop_data =</span> features,</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4"></a>  <span class="at">pop_domains =</span> <span class="st">"TA_CODE"</span>,</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5"></a>  <span class="at">smp_data =</span> pov,</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6"></a>  <span class="at">smp_domains =</span> <span class="st">"TA_CODE"</span>,</span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7"></a>  <span class="at">MSE =</span> <span class="cn">TRUE</span>,</span>
<span id="annotated-cell-4-8"><a href="#annotated-cell-4-8"></a>  <span class="at">transformation =</span> <span class="st">"arcsin"</span>,</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-4-10" class="code-annotation-target"><a href="#annotated-cell-4-10"></a>  <span class="at">weights =</span> <span class="st">"total_weights"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-4-11" class="code-annotation-target"><a href="#annotated-cell-4-11"></a>  <span class="at">pop_weights =</span> <span class="st">"mwpop"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-4-12" class="code-annotation-target"><a href="#annotated-cell-4-12"></a>  <span class="at">weights_type =</span> <span class="st">"nlme"</span>,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4" onclick="event.preventDefault();">4</a><span id="annotated-cell-4-13" class="code-annotation-target"><a href="#annotated-cell-4-13"></a>  <span class="at">benchmark =</span> bench</span>
<span id="annotated-cell-4-14"><a href="#annotated-cell-4-14"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="10" data-code-annotation="1"><code>weights = "total_weights"</code>: This is the sample weight. It is used to adjust for the fact that the survey data is not a simple random sample.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="11" data-code-annotation="2"><code>pop_weights = "mwpop"</code>: This is the population weight. It is used to adjust for the fact that different subareas have different populations.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="12" data-code-annotation="3"><code>weights_type = "nlme"</code>: This option is required when using an arcsin transformation. The default weighting type does not work with the arcsin transformation, unfortunately.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="13" data-code-annotation="4"><code>benchmark = bench</code>: This is the benchmarking option. We are benchmarking the mean poverty rate to equal 0.329, on average. </span>
</dd>
</dl>
</div>
</div>
</section>
<section id="sec-assumptions" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sec-assumptions"><span class="header-section-number">3.3</span> Verifying the assumptions</h2>
<p>Now that we have estimated the model, we can look at some statistics to verify the assumptions of the model. Since we use a parametric bootstrap, the assumption of normality is important for both the residuals and the random effects. We can look at statistics for normality using the <code>summary()</code> function:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">summary</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Empirical Best Prediction

Call:
 ebp(fixed = poor ~ average_masked + barecoverfraction + urbancoverfraction + 
    mosaik1 + mosaik39 + mosaik156 + mosaik268 + mosaik396 + 
    mosaik459 + mosaik464, pop_data = features, pop_domains = "TA_CODE", 
    smp_data = pov, smp_domains = "TA_CODE", transformation = "arcsin", 
    MSE = TRUE, na.rm = TRUE, weights = "total_weights", pop_weights = "mwpop", 
    weights_type = "nlme", benchmark = bench)

Out-of-sample domains:  27 
In-sample domains:  49 
Out-of-sample subdomains:  0 
In-sample subdomains:  0 

Sample sizes:
Units in sample:  107 
Units in population:  2908 
                   Min. 1st Qu. Median      Mean 3rd Qu. Max.
Sample_domains        1     1.0      2  2.183673       3    7
Population_domains    1     5.5     18 38.263158      44  300

Explanatory measures for the mixed model:
 Marginal_R2 Conditional_R2 Marginal_Area_R2 Conditional_Area_R2
   0.3064676       0.363829        0.6806806           0.7700488

Residual diagnostics for the mixed model:
                Skewness Kurtosis Shapiro_W  Shapiro_p
Error         -0.1317611 3.652988 0.9909934 0.70316526
Random_effect  0.3867831 5.282390 0.9465488 0.02682613

Estimated variance of random effects:
                 Variance
Error         0.030851330
Random_effect 0.002781762

ICC:  0.08270908 

Shrinkage factors 
        gamma.Min. gamma.1st.Qu. gamma.Median gamma.Mean gamma.3rd.Qu.
TA_CODE 0.08270908    0.08270908    0.1416945  0.1477909      0.189778
        gamma.Max.
TA_CODE   0.378302

Transformation:
 Transformation Shift_parameter
         arcsin               0</code></pre>
</div>
</div>
<p>Specifically, there is a section of the output entitled “Residual diagnostics for the mixed model.” Here, we can see the skewness and the kurtosis. For a normal distribution, these should be equal to zero and three, respectively. In this case, the kurtosis is a bit high for both the residuals and the random effects. This is not ideal, but given their values it is also not a huge cause for concern. We can also plot them using <code>plot(results)</code>:<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">plot</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-evaluation" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="sec-evaluation"><span class="header-section-number">3.4</span> Evaluating results</h2>
<p>The final step is to evaluate the results. We can do this in a number of ways. First, we can look at the r-squared value. Second, we can look at the change in precision from the sample to the modeled estimates. Third, we can validate the accuracy of the estimates. We will discuss each of these in turn.</p>
<section id="sec-r2" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="sec-r2"><span class="header-section-number">3.4.1</span> R-squared</h3>
<p>The <code>summary()</code> function above also output information about r-squared. There are four separate r-squared values: the marginal area r-squared, the marginal unit r-squared, the conditional area r-squared, and the conditional unit r-squared. From experience, it is the area r-squared values that are most relevant to the quality of the output. This explains the proportion of the variance across <em>areas</em> that is explained by the model (either the coefficients or both the coefficients and the random effects). In our example, the conditional area r-squared is approximately 0.77, which is relatively high.</p>
</section>
<section id="sec-precision" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="sec-precision"><span class="header-section-number">3.4.2</span> How much does precision change?</h3>
<p>Let’s compare the new estimates to sample estimates. First, let’s extract the results from the <code>results</code> object. Here, we are going to extract three things: the admin3 idenfitier, the modeled poverty rate, and the modeled variance estimates:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1" onclick="event.preventDefault();">1</a><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1"></a>resultsebp <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">cbind</span>(<span class="at">TA_CODE =</span> <span class="fu">levels</span>(results<span class="sc">$</span>ind<span class="sc">$</span>Domain),</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2" onclick="event.preventDefault();">2</a><span id="annotated-cell-7-2" class="code-annotation-target"><a href="#annotated-cell-7-2"></a>  <span class="at">poor_ebp =</span> results<span class="sc">$</span>ind<span class="sc">$</span>Mean_bench,</span>
<a class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3" onclick="event.preventDefault();">3</a><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3"></a>  <span class="at">poor_ebp_var =</span> results<span class="sc">$</span>MSE<span class="sc">$</span>Mean_bench))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-annotation">
<dl class="code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1"><code>TA_CODE = levels(results$ind$Domain)</code>: This is the admin3 identifier. It is stored as a factor variable, so we extract the levels instead of the values.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="2" data-code-annotation="2"><code>poor_ebp = results$ind$Mean</code>: This is the modeled poverty rate <em>after benchmarking</em>. It is stored in the <code>ind</code> object, which is the modeled estimates. Note that the <code>ind</code> object also includes the unbenchmarked estimates (in the column <code>Mean</code>).</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="3"><code>poor_ebp_var = results$MSE$Mean_bench</code>: This is the modeled variance estimate. It is stored in the <code>MSE</code> object, which is the modeled variance estimates. The same note about benchmarking applies here. </span>
</dd>
</dl>
</div>
</div>
<p>Next, we will estimate sample estimates. We can do this using the <code>direct()</code> function from the <code>povmap</code> package. We are going to use the <em>household-level</em> data for this, not the admin4 data. The raw survey data is saved as a Stata file, so we read it using the <code>read_dta()</code> function from the <code>haven</code> package.<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>hhs <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/ihshousehold/ihs5_consumption_aggregate.dta"</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a>hhs<span class="sc">$</span>weights <span class="ot">&lt;-</span> hhs<span class="sc">$</span>adulteq<span class="sc">*</span>hhs<span class="sc">$</span>hh_wgt</span>
<span id="cb6-3"><a href="#cb6-3"></a>estimates <span class="ot">&lt;-</span> <span class="fu">direct</span>(</span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="at">y =</span> <span class="st">"poor"</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="at">smp_data =</span> hhs,</span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="at">smp_domains =</span> <span class="st">"TA"</span>,</span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="at">weights =</span> <span class="st">"weights"</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="at">var =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="at">HT =</span> <span class="cn">TRUE</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  )</span>
<span id="cb6-11"><a href="#cb6-11"></a>resultsdirect <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">cbind</span>(<span class="at">TA_CODE =</span> <span class="fu">levels</span>(estimates<span class="sc">$</span>ind<span class="sc">$</span>Domain),</span>
<span id="cb6-12"><a href="#cb6-12"></a>  <span class="at">poor_dir =</span> estimates<span class="sc">$</span>ind<span class="sc">$</span>Mean,</span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="at">poor_dir_var =</span> estimates<span class="sc">$</span>MSE<span class="sc">$</span>Mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s join the two together and turn the values into numeric values, as well as take the square root of the variance estimates to turn them into standard errors:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>resultsall <span class="ot">&lt;-</span> resultsebp <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">left_join</span>(resultsdirect, <span class="at">by =</span> <span class="st">"TA_CODE"</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a>resultsall <span class="ot">&lt;-</span> resultsall <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">mutate</span>(<span class="at">poor_ebp =</span> <span class="fu">as.numeric</span>(poor_ebp),</span>
<span id="cb7-5"><a href="#cb7-5"></a>    <span class="at">poor_ebp_var =</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(poor_ebp_var)),</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="at">poor_dir =</span> <span class="fu">as.numeric</span>(poor_dir),</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="at">poor_dir_var =</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(poor_dir_var)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here are the results:</p>
<div class="cell" data-layout-align="center">
<div id="tbl-precision" class="cell quarto-float quarto-figure quarto-figure-center anchored" data-layout-align="center">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-precision-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Comparison of in-sample and out-of-sample estimates
</figcaption>
<div aria-describedby="tbl-precision-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">

</div>
</div>
</figure>
</div>
</div>
<p>The mean poverty rates are quite similar, but note that the standard errors are much smaller for the modeled estimates. This is because the model is able to “borrow strength” from other areas. In this example, the mean standard error decreases by about 45 percent, which is equivalent to a gain in precision from increasing the size of the survey by a factor of approximately 3.3.</p>
</section>
<section id="sec-accuracy" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="sec-accuracy"><span class="header-section-number">3.4.3</span> How can we validate the accuracy?</h3>
<p>Validating the accuracy of results can be difficult. When developing new methods, we often use census data to provide “ground truth” information, which we can compare with our modeled estimates. Of course, if we always had access to census estimates of poverty, we would not need to estimate the small area model in the first place.</p>
<p>In our case, with a sample, we can use the sample data itself to validate accuracy. How? Through cross validation. We can estimate the model on a subset of the data and then predict on the remaining data, similar to what we did above with lasso to select the variables. Here is a very simple example, where we only estimate poverty for one “fold,” or one-fifth of the data. Importantly, however, we are estimating poverty at the admin3 (TA) level, which means we need to assign admin4 (EA) to folds at the admin3 level.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># get TAs</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>povTAs <span class="ot">&lt;-</span> <span class="fu">unique</span>(pov<span class="sc">$</span>TA_CODE)</span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># assign folds - set seed so we get consistent results</span></span>
<span id="cb8-4"><a href="#cb8-4"></a><span class="fu">set.seed</span>(<span class="dv">2025</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a>povTAs <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="at">TA_CODE =</span> povTAs, <span class="at">foldTA =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">length</span>(povTAs), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-6"><a href="#cb8-6"></a><span class="co"># add back to pov</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>pov <span class="ot">&lt;-</span> pov <span class="sc">|&gt;</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>  <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(povTAs), <span class="at">by =</span> <span class="st">"TA_CODE"</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a></span>
<span id="cb8-10"><a href="#cb8-10"></a>resultscv <span class="ot">&lt;-</span> <span class="fu">ebp</span>(</span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="at">fixed =</span> ebpformula,</span>
<span id="cb8-12"><a href="#cb8-12"></a>  <span class="at">pop_data =</span> features,</span>
<span id="cb8-13"><a href="#cb8-13"></a>  <span class="at">pop_domains =</span> <span class="st">"TA_CODE"</span>,</span>
<span id="cb8-14"><a href="#cb8-14"></a>  <span class="at">smp_data =</span> pov[pov<span class="sc">$</span>foldTA<span class="sc">!=</span><span class="dv">1</span>,],</span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="at">smp_domains =</span> <span class="st">"TA_CODE"</span>,</span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="at">MSE =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="at">transformation =</span> <span class="st">"arcsin"</span>,</span>
<span id="cb8-18"><a href="#cb8-18"></a>  <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="at">weights =</span> <span class="st">"total_weights"</span>,</span>
<span id="cb8-20"><a href="#cb8-20"></a>  <span class="at">pop_weights =</span> <span class="st">"mwpop"</span>,</span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="at">weights_type =</span> <span class="st">"nlme"</span>,</span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="at">benchmark =</span> bench</span>
<span id="cb8-23"><a href="#cb8-23"></a>  )</span>
<span id="cb8-24"><a href="#cb8-24"></a>povfold1 <span class="ot">&lt;-</span> pov <span class="sc">|&gt;</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="fu">filter</span>(foldTA<span class="sc">==</span><span class="dv">1</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>  <span class="fu">group_by</span>(TA_CODE) <span class="sc">|&gt;</span></span>
<span id="cb8-27"><a href="#cb8-27"></a>  <span class="fu">summarise</span>(<span class="at">poor =</span> <span class="fu">weighted.mean</span>(poor, total_weights, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb8-29"><a href="#cb8-29"></a>resultscv <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">cbind</span>(<span class="at">TA_CODE =</span> <span class="fu">levels</span>(resultscv<span class="sc">$</span>ind<span class="sc">$</span>Domain),</span>
<span id="cb8-30"><a href="#cb8-30"></a>  <span class="at">poor_ebp =</span> resultscv<span class="sc">$</span>ind<span class="sc">$</span>Mean_bench,</span>
<span id="cb8-31"><a href="#cb8-31"></a>  <span class="at">poor_ebp_var =</span> resultscv<span class="sc">$</span>MSE<span class="sc">$</span>Mean_bench))</span>
<span id="cb8-32"><a href="#cb8-32"></a><span class="co"># turn to numeric in order to join with povfold1</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>resultscv<span class="sc">$</span>TA_CODE <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(resultscv<span class="sc">$</span>TA_CODE)</span>
<span id="cb8-34"><a href="#cb8-34"></a>resultscv <span class="ot">&lt;-</span> povfold1 <span class="sc">|&gt;</span></span>
<span id="cb8-35"><a href="#cb8-35"></a>  <span class="fu">left_join</span>(resultscv, <span class="at">by =</span> <span class="st">"TA_CODE"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>  <span class="fu">mutate</span>(<span class="at">poor_ebp =</span> <span class="fu">as.numeric</span>(poor_ebp),</span>
<span id="cb8-37"><a href="#cb8-37"></a>    <span class="at">poor_ebp_var =</span> <span class="fu">sqrt</span>(<span class="fu">as.numeric</span>(poor_ebp_var)))</span>
<span id="cb8-38"><a href="#cb8-38"></a>resultscv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we can look at statistics like correlations between the modeled and sample estimates, as well as the mean squared error. We can also plot the results, as in <a href="#fig-cvfold" class="quarto-xref">Figure&nbsp;1</a>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-cvfold" class="quarto-float quarto-figure quarto-figure-center anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-cvfold-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Predicted-true poverty rates
</figcaption>
<div aria-describedby="fig-cvfold-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="7estimation_files/figure-html/fig-cvfold-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<p>The correlation here is approximately 0.81 for fold one. Note, however, that this could be an underestimate of the true correlation. Why? Because the sample itself has sampling error. This means that the sample estimate is not the “true” value, but rather a (sampled) estimate of it.</p>
</section>
</section>
<section id="references" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="references"><span class="header-section-number">3.5</span> References</h2>
<p><a id="1"></a> Molina, Isabel, and Jon NK Rao. 2010. “Small Area Estimation of Poverty Indicators.” Canadian Journal of Statistics 38 (3): 369–85.</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>It is important to note that are estimate mean squared error (MSE) and not the variance. However, we usually assume they are the same, assuming there is no bias.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>The plot is not shown here, but you can run it on your own.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Note that we create a new weight variable to estimate headcount poverty.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>